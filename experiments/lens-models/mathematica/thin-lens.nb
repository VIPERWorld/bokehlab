(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    106677,       2561]
NotebookOptionsPosition[    103459,       2453]
NotebookOutlinePosition[    103823,       2469]
CellTagsIndexPosition[    103780,       2466]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"lineRadius", " ", "=", "20"}], ";"}]], "Input",
 CellChangeTimes->{{3.510211414239808*^9, 3.5102114170569687`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"perspectiveTransform", "[", "f_", "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", "f"}], ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"MatrixForm", "[", 
  RowBox[{"perspectiveTransform", "[", "f", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.5093557684454927`*^9, 3.509355896782833*^9}, {
   3.5093733074101257`*^9, 3.509373318345745*^9}, {3.5100682519858236`*^9, 
   3.51006825279887*^9}, 3.510068791099659*^9, {3.510069723263976*^9, 
   3.5100697473103514`*^9}, {3.510072587718813*^9, 3.510072625513975*^9}, {
   3.5100729302464046`*^9, 3.5100729314874754`*^9}, 3.5100815013596444`*^9, 
   3.5100816392085285`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", "0", "0", "0"},
     {"0", "1", "0", "0"},
     {"0", "0", "1", "0"},
     {"0", "0", 
      RowBox[{"-", 
       FractionBox["1", "f"]}], "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.5100729326375413`*^9, 3.5100815018456717`*^9, 
  3.5100823958908086`*^9, 3.5101570338310556`*^9, 3.5102112449781265`*^9}]
}, Open  ]],

Cell[TextData[{
 "Thin lens transform. Focal length of the lens is denoted by symbol ",
 StyleBox["f",
  FontSlant->"Italic"],
 " ",
 "."
}], "Text",
 CellChangeTimes->{{3.5093562554073453`*^9, 3.5093562789826937`*^9}, {
  3.5093563151907644`*^9, 3.509356324118275*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"thinLensTransform", "[", "f_", "]"}], " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "f"}], ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "f"}], ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"-", "f"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "f"}]}], "}"}]}], "}"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"thinLensTransform", "[", "f_", "]"}], " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "1"}], "/", "f"}], ",", "1"}], "}"}]}], "}"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"MatrixForm", "[", 
      RowBox[{"thinLensTransform", "[", "f", "]"}], "]"}], ",", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Inverse", "[", 
       RowBox[{"thinLensTransform", "[", "f", "]"}], "]"}], "]"}]}], 
    "}"}]}]}]], "Input",
 CellChangeTimes->{{3.509355952941045*^9, 3.5093559699970207`*^9}, {
   3.509357409695367*^9, 3.5093574110054417`*^9}, 3.509874569801518*^9, 
   3.5100688169271364`*^9, {3.5100689344798603`*^9, 3.5100689421823006`*^9}, {
   3.5100723618038917`*^9, 3.5100723641030235`*^9}, {3.5100727899223785`*^9, 
   3.5100727913354597`*^9}, {3.5100728577592583`*^9, 3.5100729244930754`*^9}, 
   3.510072961950218*^9, 3.51007364593034*^9, {3.5100744874064693`*^9, 
   3.510074489541591*^9}, {3.5100748954628086`*^9, 3.510074896740882*^9}, {
   3.510078370753584*^9, 3.5100783954909987`*^9}, {3.510078457240531*^9, 
   3.51007847104932*^9}, {3.510079230742772*^9, 3.5100793140865393`*^9}, {
   3.5100817058673415`*^9, 3.510081754607129*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"1", "0", "0", "0"},
       {"0", "1", "0", "0"},
       {"0", "0", "1", "0"},
       {"0", "0", 
        RowBox[{"-", 
         FractionBox["1", "f"]}], "1"}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]], ",", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"1", "0", "0", "0"},
       {"0", "1", "0", "0"},
       {"0", "0", "1", "0"},
       {"0", "0", 
        FractionBox["1", "f"], "1"}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], "}"}]], "Output",
 CellChangeTimes->{3.5100826786359806`*^9, 3.5101570360306597`*^9, 
  3.510166023648446*^9, 3.510211246377207*^9}]
}, Open  ]],

Cell[TextData[{
 "We generate a ray from a point on sensor {xi, yi, zs, 1} directed to a \
sampled point on the lens aperture {xa, ya, 0, 1}. Then we transform this \
input direction by the thin lens transform matrix with focal length ",
 StyleBox["f ",
  FontSlant->"Italic"],
 "to get the conjugate point. The output ray starts in the  sampled point on \
the lens aperture {xa, ya, 0, 1} and is direction towards the conjugate \
point.\n\nIt seems that the matrix ",
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", "0", "0", "0"},
     {"0", "1", "0", "0"},
     {"0", "0", "1", "0"},
     {"0", "0", 
      FractionBox["1", "f"], 
      RowBox[{"-", "1"}]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]],
  CellChangeTimes->{{3.5100805818360505`*^9, 3.510080592583665*^9}, 
    3.5100814713749294`*^9, {3.5100817064543753`*^9, 3.51008175496515*^9}, 
    3.51008192175969*^9}],
 " suggested in literature doesn\[CloseCurlyQuote]t work well. However, the \
matrix ",
 Cell[BoxData[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", "0", "0", "0"},
     {"0", "1", "0", "0"},
     {"0", "0", "1", "0"},
     {"0", "0", 
      RowBox[{"-", 
       FractionBox["1", "f"]}], "1"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}]],
  CellChangeTimes->{{3.5100805818360505`*^9, 3.510080592583665*^9}, 
    3.5100814713749294`*^9, {3.5100817064543753`*^9, 3.51008175496515*^9}, 
    3.51008192175969*^9}],
 " behaves well. The sign of the provided focal length f needs to be the same \
as the sign of the z component of the source point coordinates."
}], "Text",
 CellChangeTimes->{{3.5093561756057806`*^9, 3.509356214772021*^9}, {
  3.509356341465267*^9, 3.5093564477823486`*^9}, {3.509357709302503*^9, 
  3.5093577949584026`*^9}, {3.5100821689478283`*^9, 3.5100822928089123`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"addFocalLengthSign", "[", 
    RowBox[{"f_", ",", "z_"}], "]"}], " ", ":=", 
   RowBox[{
    RowBox[{"Sign", "[", "z", "]"}], "*", "f"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getXZ", "[", "xyzw_", " ", "]"}], " ", ":=", 
   RowBox[{"Part", "[", 
    RowBox[{"xyzw", ",", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getXYZ", "[", "xyzw_", " ", "]"}], " ", ":=", 
   RowBox[{"xyzw", "[", 
    RowBox[{"[", 
     RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"homogeneousDivide", "[", "xyzw_", "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"xyz", ",", "w"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xyz", " ", "=", " ", 
       RowBox[{"xyzw", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", " ", 
       RowBox[{"xyzw", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"w", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
        RowBox[{"xyzw", " ", "/", " ", "w"}], ",", " ", "xyzw"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fromHomogeneous", "[", "xyzw_", "]"}], " ", ":=", " ", 
   RowBox[{"getXYZ", "[", 
    RowBox[{"homogeneousDivide", "[", "xyzw", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"thinLensXZ", "[", 
    RowBox[{"point_", ",", " ", "f_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"getXZ", "[", 
    RowBox[{"fromHomogeneous", "[", 
     RowBox[{
      RowBox[{"thinLensTransform", "[", 
       RowBox[{"addFocalLengthSign", "[", 
        RowBox[{"f", ",", 
         RowBox[{"point", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], ".", "point"}], 
     "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"thinLens", "[", 
    RowBox[{"point_", ",", " ", "f_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"thinLensTransform", "[", 
     RowBox[{"addFocalLengthSign", "[", 
      RowBox[{"f", ",", 
       RowBox[{"point", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], ".", "point"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"perspective", "[", 
    RowBox[{"point_", ",", " ", "f_"}], "]"}], ":=", 
   RowBox[{"getXZ", "[", 
    RowBox[{"fromHomogeneous", "[", 
     RowBox[{
      RowBox[{"perspectiveTransform", "[", 
       RowBox[{"addFocalLengthSign", "[", 
        RowBox[{"f", ",", 
         RowBox[{"point", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], ".", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"point", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
        RowBox[{"point", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", "1"}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uniformSampleLensX", "[", 
   RowBox[{"apertureRadius_", ",", "count_", ",", " ", "func_"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Table", "[", 
    RowBox[{"func", ",", " ", 
     RowBox[{"{", 
      RowBox[{"lensX", ",", " ", 
       RowBox[{"-", "apertureRadius"}], ",", " ", "apertureRadius", ",", " ", 
       RowBox[{"2", "*", 
        RowBox[{"apertureRadius", "/", 
         RowBox[{"(", 
          RowBox[{"count", "-", "1"}], ")"}]}]}]}], "}"}]}], "]"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.509356454717745*^9, 3.509356496646143*^9}, {
   3.5093566487718444`*^9, 3.509356666762873*^9}, {3.509356698210672*^9, 
   3.509356709226302*^9}, {3.509356813685277*^9, 3.5093568254859514`*^9}, {
   3.509356865829259*^9, 3.509356998826866*^9}, {3.5093571197967854`*^9, 
   3.5093571225149407`*^9}, {3.50935747409805*^9, 3.5093575207207165`*^9}, {
   3.5093575630811396`*^9, 3.509357590416703*^9}, {3.5093579273999777`*^9, 
   3.50935795313945*^9}, {3.509358029136797*^9, 3.5093580535961957`*^9}, {
   3.509358089480248*^9, 3.509358096758664*^9}, 3.5093581586422043`*^9, {
   3.5100723837951493`*^9, 3.510072448244836*^9}, {3.510072628797163*^9, 
   3.5100726519254856`*^9}, {3.5100727098747997`*^9, 3.5100727163111687`*^9}, 
   3.510073664534404*^9, 3.5100740280231943`*^9, 3.510074548908987*^9, 
   3.5100745899353333`*^9, 3.510074637986082*^9, 3.5100780599748087`*^9, 
   3.510078189347208*^9, 3.5100782356428556`*^9, 3.5100784875642653`*^9, {
   3.5100786505145855`*^9, 3.5100786556228776`*^9}, 3.5100787197925477`*^9, {
   3.5100788646328325`*^9, 3.510078868407048*^9}, {3.51007914171268*^9, 
   3.510079143320772*^9}, {3.5100794590748324`*^9, 3.5100795025973215`*^9}, 
   3.5100795677420473`*^9, 3.510079695128334*^9, {3.51008012130571*^9, 
   3.510080132270337*^9}, {3.5100812161853333`*^9, 3.5100812190975*^9}, {
   3.5100819527354617`*^9, 3.5100819551976023`*^9}, 3.510164829222129*^9, {
   3.5101650537209697`*^9, 3.510165095252345*^9}, {3.510165133695544*^9, 
   3.510165231647146*^9}, {3.5101652743375883`*^9, 3.510165464981492*^9}, 
   3.510165769576914*^9, {3.51016587213278*^9, 3.510165874014888*^9}, {
   3.510165906528747*^9, 3.510165924079751*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"makeThinLensGraphics", "[", 
    RowBox[{
    "transform_", ",", "focalLength_", ",", " ", "apertureRadius_", ",", " ", 
     "rayCount_", ",", " ", "x_", ",", " ", "z_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"input", ",", " ", "output", ",", " ", "y"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"y", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"input", " ", "=", 
       RowBox[{"getXZ", "[", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z", ",", "1"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", " ", "=", " ", 
       RowBox[{"transform", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "z", ",", "1"}], "}"}], ",", 
         "focalLength"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"uniformSampleLensX", "[", 
           RowBox[{"apertureRadius", ",", " ", "rayCount", ",", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Gray", ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"input", ",", 
                 RowBox[{"{", 
                  RowBox[{"lensX", ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
              "\[IndentingNewLine]", "Gray", ",", " ", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"lensX", ",", "0"}], "}"}], ",", "output"}], "}"}], 
               "]"}], ",", "\[IndentingNewLine]", "Green", ",", " ", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"input", ",", "output"}], "}"}], "]"}], ",", 
              "\[IndentingNewLine]", "Red", ",", 
              RowBox[{"Point", "[", 
               RowBox[{"{", 
                RowBox[{"lensX", ",", "0"}], "}"}], "]"}]}], "}"}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"Blue", ",", " ", 
            RowBox[{"Point", "[", "input", "]"}], ",", "Orange", ",", " ", 
            RowBox[{"Point", "[", "output", "]"}], ",", "\[IndentingNewLine]",
             "Gray", ",", "\[IndentingNewLine]", 
            RowBox[{"Tooltip", "[", 
             RowBox[{
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "10"}], ",", " ", 
                   RowBox[{"-", "focalLength"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"10", ",", " ", 
                   RowBox[{"-", "focalLength"}]}], "}"}]}], "}"}], "]"}], ",",
               " ", "\"\<Focal length in object space\>\""}], "]"}], ",", 
            "\[IndentingNewLine]", "Blue", ",", "\[IndentingNewLine]", 
            RowBox[{"Tooltip", "[", 
             RowBox[{
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "10"}], ",", " ", "focalLength"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"10", ",", " ", "focalLength"}], "}"}]}], "}"}], 
               "]"}], ",", " ", 
              "\"\<Sensor at focal length in image space\>\""}], "]"}]}], 
           "\[IndentingNewLine]", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Axes", "\[Rule]", "True"}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<x\>\"", ",", "\"\<z\>\""}], "}"}]}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", " ", 
        RowBox[{"PlotRangeClipping", "\[Rule]", "True"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "}"}]}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"makeThinLensGraphics", "[", 
    RowBox[{
    "transform", ",", "focalLength", ",", " ", "apertureRadius", ",", " ", 
     "rayCount", ",", " ", "x", ",", " ", "z"}], "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", "1"}], "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"z", ",", " ", "5"}], "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", " ", "2"}], "}"}], ",", "0", ",", "10"}], 
    "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"apertureRadius", ",", " ", "5"}], "}"}], ",", " ", "0.1", ",", 
     " ", "10"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rayCount", ",", " ", "7"}], "}"}], ",", " ", "2", ",", " ", 
     "10", ",", " ", "1"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"transform", ",", " ", 
     RowBox[{"{", 
      RowBox[{"thinLensXZ", ",", "perspective"}], "}"}]}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.509369255421215*^9, 3.5093694263139896`*^9}, {
   3.509369632372775*^9, 3.509369744888211*^9}, {3.50936988299411*^9, 
   3.5093698856102595`*^9}, {3.5093699378262463`*^9, 3.509369945338676*^9}, {
   3.5093699966276093`*^9, 3.5093701995712175`*^9}, {3.509370239778517*^9, 
   3.50937026447993*^9}, {3.5093703988546157`*^9, 3.5093704380318565`*^9}, {
   3.5093704853965654`*^9, 3.5093705044686565`*^9}, {3.5093705909486027`*^9, 
   3.50937059177265*^9}, {3.5093706450606976`*^9, 3.5093706808937473`*^9}, {
   3.509370745591448*^9, 3.509370779093364*^9}, {3.5093710429278164`*^9, 
   3.5093711043323283`*^9}, {3.509371248558953*^9, 3.509371274159417*^9}, {
   3.509371335834729*^9, 3.5093713575449705`*^9}, {3.509372030807621*^9, 
   3.509372145763584*^9}, {3.50937235662123*^9, 3.509372442750157*^9}, {
   3.509372518196472*^9, 3.509372518827508*^9}, {3.5093725629610324`*^9, 
   3.509372646419806*^9}, {3.509372833995672*^9, 3.5093729470961084`*^9}, {
   3.50937329530025*^9, 3.5093732963298516`*^9}, {3.509373399159392*^9, 
   3.509373459550227*^9}, {3.509376793855995*^9, 3.5093768053496523`*^9}, {
   3.5093781258034086`*^9, 3.5093781401552296`*^9}, {3.5093910275420074`*^9, 
   3.5093910290240107`*^9}, {3.5093911365252423`*^9, 3.509391143139654*^9}, {
   3.509391222326538*^9, 3.5093912249716897`*^9}, {3.509391291749189*^9, 
   3.509391293131268*^9}, {3.5094302631650867`*^9, 3.509430280996106*^9}, {
   3.5094303784234133`*^9, 3.509430412684066*^9}, {3.510069800736407*^9, 
   3.510069841862759*^9}, {3.510069975573407*^9, 3.5100700126805296`*^9}, {
   3.5100701363996058`*^9, 3.51007014259496*^9}, {3.510070188245571*^9, 
   3.510070216412182*^9}, {3.510072579424339*^9, 3.5100725841936116`*^9}, {
   3.5100726653082514`*^9, 3.5100726733217096`*^9}, {3.510072751440178*^9, 
   3.5100727576795344`*^9}, 3.510074628149519*^9, 3.510078499050922*^9, {
   3.510078763833067*^9, 3.510078764776121*^9}, {3.5100798223076077`*^9, 
   3.5100798275709095`*^9}, {3.5100806194822035`*^9, 3.510080623802451*^9}, {
   3.5100808859864473`*^9, 3.510080887019506*^9}, 3.5100812352654247`*^9, 
   3.51008129235769*^9, {3.510081746280653*^9, 3.510081748371773*^9}, 
   3.5100817936533623`*^9, 3.510081937730603*^9, {3.510082037804327*^9, 
   3.510082038763382*^9}, {3.510082671753587*^9, 3.5100826729826574`*^9}, 
   3.5101648300691776`*^9, {3.5101648735146627`*^9, 3.510164909707732*^9}, {
   3.510164947468892*^9, 3.5101649755184965`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`apertureRadius$$ = 
    5, $CellContext`focalLength$$ = 2, $CellContext`rayCount$$ = 
    7, $CellContext`transform$$ = $CellContext`thinLensXZ, $CellContext`x$$ = 
    1, $CellContext`z$$ = -2.0999999999999996`, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`x$$], 1}, -10, 10}, {{
       Hold[$CellContext`z$$], 5}, -10, 10}, {{
       Hold[$CellContext`focalLength$$], 2}, 0, 10}, {{
       Hold[$CellContext`apertureRadius$$], 5}, 0.1, 10}, {{
       Hold[$CellContext`rayCount$$], 7}, 2, 10, 1}, {
      Hold[$CellContext`transform$$], {$CellContext`thinLensXZ, \
$CellContext`perspective}}}, Typeset`size$$ = {360., {178., 182.}}, 
    Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`x$1728$$ = 0, $CellContext`z$1729$$ = 
    0, $CellContext`focalLength$1730$$ = 
    0, $CellContext`apertureRadius$1731$$ = 0, $CellContext`rayCount$1732$$ = 
    0, $CellContext`transform$1733$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`apertureRadius$$ = 
        5, $CellContext`focalLength$$ = 2, $CellContext`rayCount$$ = 
        7, $CellContext`transform$$ = $CellContext`thinLensXZ, \
$CellContext`x$$ = 1, $CellContext`z$$ = 5}, "ControllerVariables" :> {
        Hold[$CellContext`x$$, $CellContext`x$1728$$, 0], 
        Hold[$CellContext`z$$, $CellContext`z$1729$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$1730$$, 0], 
        Hold[$CellContext`apertureRadius$$, \
$CellContext`apertureRadius$1731$$, 0], 
        Hold[$CellContext`rayCount$$, $CellContext`rayCount$1732$$, 0], 
        Hold[$CellContext`transform$$, $CellContext`transform$1733$$, False]},
       "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> $CellContext`makeThinLensGraphics[$CellContext`transform$$, \
$CellContext`focalLength$$, $CellContext`apertureRadius$$, \
$CellContext`rayCount$$, $CellContext`x$$, $CellContext`z$$], 
      "Specifications" :> {{{$CellContext`x$$, 1}, -10, 
         10}, {{$CellContext`z$$, 5}, -10, 
         10}, {{$CellContext`focalLength$$, 2}, 0, 
         10}, {{$CellContext`apertureRadius$$, 5}, 0.1, 
         10}, {{$CellContext`rayCount$$, 7}, 2, 10, 
         1}, {$CellContext`transform$$, {$CellContext`thinLensXZ, \
$CellContext`perspective}}}, "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {290., 295.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101648897235894`*^9, 3.510164910321768*^9}, {
   3.510164950774081*^9, 3.510164976158533*^9}, 3.510165760465393*^9, 
   3.5101660293237705`*^9, {3.510166119970956*^9, 3.510166133373722*^9}, 
   3.5102112504884415`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"makeThinLensGraphics", "[", 
    RowBox[{
    "transform", ",", "focalLength", ",", " ", "apertureRadius", ",", " ", 
     "rayCount", ",", " ", "x", ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "a"}], "*", "x"}], " ", "+", " ", "b"}]}], "]"}], ",", 
   " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", 
       RowBox[{"-", "5"}]}], "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", " ", "1"}], "}"}], ",", " ", 
     RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b", ",", " ", "1"}], "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", " ", "10"}], "}"}], ",", " ", "0", ",", 
     "10"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"apertureRadius", ",", " ", "5"}], "}"}], ",", " ", "0.1", ",", 
     " ", "10"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rayCount", ",", " ", "7"}], "}"}], ",", " ", "2", ",", " ", 
     "10", ",", " ", "1"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"transform", ",", " ", 
     RowBox[{"{", 
      RowBox[{"thinLensXZ", ",", "perspective"}], "}"}]}], "}"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.5093914119439917`*^9, 3.509391491622962*^9}, {
   3.509391524507843*^9, 3.509391537744384*^9}, {3.509391571458312*^9, 
   3.5093915745854907`*^9}, {3.5093916635855813`*^9, 
   3.5093916760972967`*^9}, {3.5093918252338142`*^9, 3.5093918425298033`*^9}, 
   3.509429841028373*^9, {3.5094300791413755`*^9, 3.5094300822835555`*^9}, {
   3.50943070233467*^9, 3.509430703803754*^9}, {3.5100702963187523`*^9, 
   3.510070297411815*^9}, 3.5101648346394386`*^9, {3.510165013985697*^9, 
   3.510165022487183*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`a$$ = 1, $CellContext`apertureRadius$$ = 
    5, $CellContext`b$$ = 1, $CellContext`focalLength$$ = 
    10, $CellContext`rayCount$$ = 
    7, $CellContext`transform$$ = $CellContext`thinLensXZ, $CellContext`x$$ = \
-5, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`x$$], -5}, -10, 10}, {{
       Hold[$CellContext`a$$], 1}, -5, 5}, {{
       Hold[$CellContext`b$$], 1}, -10, 10}, {{
       Hold[$CellContext`focalLength$$], 10}, 0, 10}, {{
       Hold[$CellContext`apertureRadius$$], 5}, 0.1, 10}, {{
       Hold[$CellContext`rayCount$$], 7}, 2, 10, 1}, {
      Hold[$CellContext`transform$$], {$CellContext`thinLensXZ, \
$CellContext`perspective}}}, Typeset`size$$ = {360., {178., 182.}}, 
    Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`x$9650$$ = 0, $CellContext`a$9651$$ = 
    0, $CellContext`b$9652$$ = 0, $CellContext`focalLength$9653$$ = 
    0, $CellContext`apertureRadius$9654$$ = 0, $CellContext`rayCount$9655$$ = 
    0, $CellContext`transform$9656$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`a$$ = 1, $CellContext`apertureRadius$$ = 
        5, $CellContext`b$$ = 1, $CellContext`focalLength$$ = 
        10, $CellContext`rayCount$$ = 
        7, $CellContext`transform$$ = $CellContext`thinLensXZ, \
$CellContext`x$$ = -5}, "ControllerVariables" :> {
        Hold[$CellContext`x$$, $CellContext`x$9650$$, 0], 
        Hold[$CellContext`a$$, $CellContext`a$9651$$, 0], 
        Hold[$CellContext`b$$, $CellContext`b$9652$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$9653$$, 0], 
        Hold[$CellContext`apertureRadius$$, \
$CellContext`apertureRadius$9654$$, 0], 
        Hold[$CellContext`rayCount$$, $CellContext`rayCount$9655$$, 0], 
        Hold[$CellContext`transform$$, $CellContext`transform$9656$$, False]},
       "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> $CellContext`makeThinLensGraphics[$CellContext`transform$$, \
$CellContext`focalLength$$, $CellContext`apertureRadius$$, \
$CellContext`rayCount$$, $CellContext`x$$, (-$CellContext`a$$) \
$CellContext`x$$ + $CellContext`b$$], 
      "Specifications" :> {{{$CellContext`x$$, -5}, -10, 
         10}, {{$CellContext`a$$, 1}, -5, 5}, {{$CellContext`b$$, 1}, -10, 
         10}, {{$CellContext`focalLength$$, 10}, 0, 
         10}, {{$CellContext`apertureRadius$$, 5}, 0.1, 
         10}, {{$CellContext`rayCount$$, 7}, 2, 10, 
         1}, {$CellContext`transform$$, {$CellContext`thinLensXZ, \
$CellContext`perspective}}}, "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {303., 308.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.51016502295821*^9, {3.510166116850777*^9, 3.5101661388870373`*^9}}]
}, Open  ]],

Cell["\<\
This experiment should show whether the simple thin lens model inherently \
behaves as expected when the sensor plane is tilted.\
\>", "Text",
 CellChangeTimes->{{3.5094290781498756`*^9, 3.509429129204796*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"z", ",", "sourcePoint", ",", " ", "targetPoint"}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"z", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "a"}], "*", "x"}], " ", "+", "b"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"sourcePoint", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{"x", ",", "z"}], "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"targetPoint", " ", "=", " ", 
              RowBox[{"thinLensXZ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "z", ",", "1"}], "}"}], ",", 
                "focalLength"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Hue", "[", 
                RowBox[{
                 RowBox[{"x", "/", "10"}], "+", "0.5"}], "]"}], ",", 
               RowBox[{"Arrow", "[", 
                RowBox[{"{", 
                 RowBox[{"sourcePoint", ",", "targetPoint"}], "}"}], "]"}], 
               ","}], "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Point", "[", 
                RowBox[{"{", 
                 RowBox[{"targetPoint", ",", "sourcePoint"}], "}"}], "]"}], 
               "*)"}], "\[IndentingNewLine]", "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"x", ",", " ", 
            RowBox[{"-", "5"}], ",", "5", ",", "0.2"}], "}"}]}], "]"}], "]"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"Darker", "[", "Green", "]"}], ",", 
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "50"}], ",", "focalLength"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"50", ",", "focalLength"}], "}"}]}], "}"}], "]"}], ",", 
         "\"\<Focal plane with no tilt\>\""}], "]"}]}], "\[IndentingNewLine]",
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<x\>\"", ",", "\"\<z\>\""}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", " ", 
       RowBox[{"-", "0.05"}]}], "}"}], ",", " ", 
     RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b", ",", " ", "1.5"}], "}"}], ",", " ", 
     RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", " ", "2"}], "}"}], ",", " ", "0", ",", 
     "10"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.509391955851285*^9, 3.5093920231051316`*^9}, {
   3.509392085874722*^9, 3.5093921764589033`*^9}, {3.5093922297559514`*^9, 
   3.509392307655407*^9}, {3.5093923886000366`*^9, 3.5093924675135503`*^9}, {
   3.5093925295310974`*^9, 3.5093925540895023`*^9}, {3.5093926997468333`*^9, 
   3.50939272573532*^9}, {3.509428181007948*^9, 3.5094281817909927`*^9}, {
   3.509428237960205*^9, 3.509428256110243*^9}, {3.509428428512104*^9, 
   3.509428565736953*^9}, {3.5094287946438546`*^9, 3.509428841201329*^9}, {
   3.5094299199008837`*^9, 3.5094299210129476`*^9}, {3.509814148944728*^9, 
   3.5098142198417826`*^9}, {3.509815253474903*^9, 3.509815330491308*^9}, {
   3.5098153623341293`*^9, 3.5098153694185343`*^9}, {3.5098155517859654`*^9, 
   3.509815578862514*^9}, {3.509815611325371*^9, 3.5098156321345615`*^9}, {
   3.5098156995564175`*^9, 3.509815740286747*^9}, {3.5098157841862583`*^9, 
   3.509815785569337*^9}, {3.5098158651848907`*^9, 3.5098158963806753`*^9}, {
   3.5098159974024534`*^9, 3.509816098503236*^9}, {3.5098161974718966`*^9, 
   3.509816249669882*^9}, {3.5098162867540035`*^9, 3.5098162976996293`*^9}, {
   3.5098163307635202`*^9, 3.50981633285264*^9}, {3.509816365492507*^9, 
   3.509816412363188*^9}, 3.5098164497723274`*^9, 3.5098165373963394`*^9, 
   3.5098165741584415`*^9, {3.509816637054039*^9, 3.509816675257224*^9}, {
   3.5098746155261335`*^9, 3.509874642150656*^9}, {3.510070334656945*^9, 
   3.510070339927247*^9}, {3.5100747003616495`*^9, 3.5100747123053327`*^9}, 
   3.5101648390916934`*^9, {3.5101661052741146`*^9, 3.5101661061291637`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`a$$ = -0.05, $CellContext`b$$ = 
    1.5, $CellContext`focalLength$$ = 2, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`a$$], -0.05}, -5, 5}, {{
       Hold[$CellContext`b$$], 1.5}, -5, 5}, {{
       Hold[$CellContext`focalLength$$], 2}, 0, 10}}, Typeset`size$$ = {
    360., {178., 182.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`a$9706$$ = 
    0, $CellContext`b$9707$$ = 0, $CellContext`focalLength$9708$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`a$$ = -0.05, $CellContext`b$$ = 
        1.5, $CellContext`focalLength$$ = 2}, "ControllerVariables" :> {
        Hold[$CellContext`a$$, $CellContext`a$9706$$, 0], 
        Hold[$CellContext`b$$, $CellContext`b$9707$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$9708$$, 0]},
       "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Graphics[{
         Flatten[
          Table[
           
           Module[{$CellContext`z$, $CellContext`sourcePoint$, \
$CellContext`targetPoint$}, $CellContext`z$ = (-$CellContext`a$$) \
$CellContext`x + $CellContext`b$$; $CellContext`sourcePoint$ = \
{$CellContext`x, $CellContext`z$}; $CellContext`targetPoint$ = \
$CellContext`thinLensXZ[{$CellContext`x, 0, $CellContext`z$, 
                1}, $CellContext`focalLength$$]; {
              Hue[$CellContext`x/10 + 0.5], 
              Arrow[{$CellContext`sourcePoint$, $CellContext`targetPoint$}], 
              Null}], {$CellContext`x, -5, 5, 0.2}]], 
         Darker[Green], 
         Tooltip[
          
          Line[{{-50, $CellContext`focalLength$$}, {
            50, $CellContext`focalLength$$}}], "Focal plane with no tilt"]}, 
        Axes -> True, AxesLabel -> {"x", "z"}, Frame -> True, FrameTicks -> 
        Automatic, PlotRange -> {{-10, 10}, {-10, 10}}], 
      "Specifications" :> {{{$CellContext`a$$, -0.05}, -5, 
         5}, {{$CellContext`b$$, 1.5}, -5, 
         5}, {{$CellContext`focalLength$$, 2}, 0, 10}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{409., {251., 256.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5094288264281034`*^9, 3.509428842152931*^9}, 
   3.509429921689986*^9, 3.5098142205758247`*^9, {3.509815268305751*^9, 
   3.5098153309383335`*^9}, {3.5098153641192317`*^9, 3.5098153700885725`*^9}, 
   3.5098155792525363`*^9, {3.509815620076872*^9, 3.509815632711594*^9}, {
   3.509815701319518*^9, 3.5098157411677976`*^9}, 3.509815786156371*^9, {
   3.5098160502464757`*^9, 3.5098160672894506`*^9}, 3.509816102815482*^9, {
   3.509816240331348*^9, 3.509816252633052*^9}, 3.5098162986296825`*^9, 
   3.509816368982706*^9, {3.509816399013424*^9, 3.509816413496252*^9}, 
   3.5098164512914143`*^9, 3.509816539672469*^9, 3.509816575757533*^9, {
   3.5098166423043394`*^9, 3.509816675967265*^9}, 3.509874597234087*^9, {
   3.5098746282208595`*^9, 3.5098746428526964`*^9}, 3.510068871117236*^9, 
   3.5100703041632013`*^9, 3.5100703406072855`*^9, {3.51007469372427*^9, 
   3.510074712868365*^9}, 3.510165025897378*^9, {3.510165749000737*^9, 
   3.5101657546020575`*^9}, {3.5101661026979675`*^9, 3.5101661074052367`*^9}, 
   3.51016614103316*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"thinLensXZ", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2", ",", "0", ",", "200", ",", "1"}], "}"}], ",", "5"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.5100789278914504`*^9, 3.5100789491216645`*^9}, {
   3.5100789904830303`*^9, 3.510079011299221*^9}, {3.510079045188159*^9, 
   3.510079066762393*^9}, 3.5101648401797557`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox["2", "41"]}], ",", 
   RowBox[{"-", 
    FractionBox["200", "41"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.5100789428103037`*^9, 3.510078949459684*^9}, {
   3.5100789985274906`*^9, 3.5100790118112507`*^9}, {3.5100790555877542`*^9, 
   3.510079067161416*^9}, 3.510079781695285*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"fromHomogeneous", "[", 
   RowBox[{
    RowBox[{"thinLensTransform", "[", 
     RowBox[{"-", "2"}], "]"}], ".", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0", ",", "5", ",", "1"}], "}"}]}], "]"}], " ", "//", 
  " ", "N"}]], "Input",
 CellChangeTimes->{{3.5100791571225615`*^9, 3.5100791714273796`*^9}, {
   3.510079331267522*^9, 3.5100793810673704`*^9}, {3.5100795129629145`*^9, 
   3.510079555614354*^9}, 3.510079663902548*^9, {3.510079718333661*^9, 
   3.510079796484131*^9}, {3.5100801694764647`*^9, 3.510080172292626*^9}, {
   3.5100806804606915`*^9, 3.5100807080832715`*^9}, {3.5100808970600805`*^9, 
   3.5100808974041*^9}, {3.5100809488840446`*^9, 3.51008096103574*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.2857142857142857`"}], ",", "0.`", ",", 
   RowBox[{"-", "1.4285714285714286`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.5100795409925175`*^9, 3.510079578190645*^9}, 
   3.51007966428257*^9, {3.510079716723569*^9, 3.5100797968581524`*^9}, {
   3.510080167270339*^9, 3.510080175126788*^9}, {3.5100806842139063`*^9, 
   3.5100807086733055`*^9}, 3.5100808978581257`*^9, {3.510080950332127*^9, 
   3.5100809613317566`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tl", " ", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", 
        RowBox[{"1", "/", "f"}], ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tlInv", " ", "=", " ", 
   RowBox[{"Inverse", "[", "tl", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"MatrixForm", "[", "tl", "]"}], ",", 
   RowBox[{"MatrixForm", "[", "tlInv", "]"}]}], "}"}], "\[IndentingNewLine]", 
 RowBox[{"tl", ".", "tlInv"}]}], "Input",
 CellChangeTimes->{{3.5100800335176888`*^9, 3.510080041320135*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"1", "0", "0", "0"},
       {"0", "1", "0", "0"},
       {"0", "0", "1", "0"},
       {"0", "0", 
        FractionBox["1", "f"], 
        RowBox[{"-", "1"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]], ",", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"1", "0", "0", "0"},
       {"0", "1", "0", "0"},
       {"0", "0", "1", "0"},
       {"0", "0", 
        FractionBox["1", "f"], 
        RowBox[{"-", "1"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], "}"}]], "Output",
 CellChangeTimes->{3.510079928075658*^9, 3.510080041901168*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.510079928075658*^9, 3.510080041903168*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"tl", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "f", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "f", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", 
       RowBox[{"-", "f"}]}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tlInv", " ", "=", " ", 
   RowBox[{"Inverse", "[", "tl", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"MatrixForm", "[", "tl", "]"}], ",", 
   RowBox[{"MatrixForm", "[", "tlInv", "]"}]}], "}"}], "\[IndentingNewLine]", 
 RowBox[{"tl", ".", "tlInv"}]}], "Input",
 CellChangeTimes->{{3.510079931921878*^9, 3.510079938945279*^9}, {
  3.510079977264471*^9, 3.510080019769902*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"f", "0", "0", "0"},
       {"0", "f", "0", "0"},
       {"0", "0", "f", "0"},
       {"0", "0", "1", 
        RowBox[{"-", "f"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]], ",", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        FractionBox["1", "f"], "0", "0", "0"},
       {"0", 
        FractionBox["1", "f"], "0", "0"},
       {"0", "0", 
        FractionBox["1", "f"], "0"},
       {"0", "0", 
        FractionBox["1", 
         SuperscriptBox["f", "2"]], 
        RowBox[{"-", 
         FractionBox["1", "f"]}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], "}"}]], "Output",
 CellChangeTimes->{
  3.510079942862503*^9, {3.510079995044488*^9, 3.510080020268931*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.510079942862503*^9, {3.510079995044488*^9, 3.510080020270931*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"tl", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "f", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "f", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"-", "1"}], ",", "f"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tlInv", " ", "=", " ", 
   RowBox[{"Inverse", "[", "tl", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"MatrixForm", "[", "tl", "]"}], ",", 
   RowBox[{"MatrixForm", "[", "tlInv", "]"}]}], "}"}], "\[IndentingNewLine]", 
 RowBox[{"tl", ".", "tlInv"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", 
  RowBox[{"tl", ",", " ", "tlInv"}], "]"}]}], "Input",
 CellChangeTimes->{{3.5100818946331387`*^9, 3.510081909954015*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"f", "0", "0", "0"},
       {"0", "f", "0", "0"},
       {"0", "0", "f", "0"},
       {"0", "0", 
        RowBox[{"-", "1"}], "f"}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]], ",", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        FractionBox["1", "f"], "0", "0", "0"},
       {"0", 
        FractionBox["1", "f"], "0", "0"},
       {"0", "0", 
        FractionBox["1", "f"], "0"},
       {"0", "0", 
        FractionBox["1", 
         SuperscriptBox["f", "2"]], 
        FractionBox["1", "f"]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], "}"}]], "Output",
 CellChangeTimes->{{3.5100818972212863`*^9, 3.5100819102170296`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.5100818972212863`*^9, 3.5100819102210298`*^9}}]
}, Open  ]],

Cell["\<\
Circle of confusion calculation:\
\>", "Text",
 CellChangeTimes->{{3.510157062644306*^9, 3.51015707061592*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"circleOfConfusion", "[", 
    RowBox[{
    "objectZ_", ",", "focusPlaneZ_", ",", " ", "aperture_", ",", 
     "focalLength_"}], "]"}], " ", ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Abs", "[", 
     RowBox[{"objectZ", " ", "-", " ", "focusPlaneZ"}], "]"}], " ", "*", " ", 
    "focalLength", " ", "*", " ", 
    RowBox[{"aperture", " ", "/", " ", 
     RowBox[{"(", 
      RowBox[{"objectZ", " ", "*", " ", 
       RowBox[{"(", 
        RowBox[{"focusPlaneZ", " ", "-", "focalLength"}], ")"}]}], 
      ")"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"circleOfConfusionInfFocus", "[", 
    RowBox[{"objectZ_", ",", "aperture_", ",", "focalLength_"}], "]"}], " ", ":=",
    "\[IndentingNewLine]", 
   RowBox[{"focalLength", " ", "*", " ", 
    RowBox[{"aperture", " ", "/", " ", "objectZ"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"circleOfConfusionInfObject", "[", 
    RowBox[{"focusPlaneZ_", ",", "aperture_", ",", "focalLength_"}], "]"}], 
   " ", ":=", "\[IndentingNewLine]", 
   RowBox[{"focalLength", " ", "*", " ", 
    RowBox[{"aperture", " ", "/", " ", 
     RowBox[{"(", 
      RowBox[{"focusPlaneZ", " ", "-", " ", "focalLength"}], ")"}]}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.5101570784939337`*^9, 3.510157230656601*^9}, {
  3.510157265834663*^9, 3.510157419073732*^9}, {3.5101574704134226`*^9, 
  3.510157916009405*^9}, {3.510157950984667*^9, 3.510157982512322*^9}, {
  3.51015801556878*^9, 3.510158017456383*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"circleOfConfusion", "[", 
          RowBox[{
          "objectZ", ",", "focusPlaneZ", ",", " ", "aperture", ",", 
           "focalLength"}], "]"}], ",", "\"\<Circle of confusion\>\""}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"circleOfConfusionInfFocus", "[", 
          RowBox[{"objectZ", ",", " ", "aperture", ",", " ", "focalLength"}], 
          "]"}], ",", 
         "\"\<Circle of confusion for infinite focus plane\>\""}], "]"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"circleOfConfusionInfObject", "[", 
          RowBox[{
          "focusPlaneZ", ",", " ", "aperture", ",", " ", "focalLength"}], 
          "]"}], ",", 
         "\"\<Circle of confusion for an object at infinity\>\""}], "]"}], 
       ","}], "\[IndentingNewLine]", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"objectZ", ",", " ", "0", ",", " ", "1000"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "1000"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "5"}], "}"}]}], "}"}]}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"focusPlaneZ", ",", " ", "100", ",", " ", "1000"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"aperture", ",", " ", "2.5", ",", " ", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", "50"}], "}"}], ",", " ", "5", ",", " ", 
     "100"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.510158020342388*^9, 3.5101580220895915`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`aperture$$ = 
    2.5, $CellContext`focalLength$$ = 50, $CellContext`focusPlaneZ$$ = 100, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`focusPlaneZ$$], 100, 1000}, {
      Hold[$CellContext`aperture$$], 2.5, 5}, {{
       Hold[$CellContext`focalLength$$], 50}, 5, 100}}, Typeset`size$$ = {
    360., {114., 119.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`focusPlaneZ$6627$$ = 
    0, $CellContext`aperture$6628$$ = 0, $CellContext`focalLength$6629$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`aperture$$ = 
        2.5, $CellContext`focalLength$$ = 50, $CellContext`focusPlaneZ$$ = 
        100}, "ControllerVariables" :> {
        Hold[$CellContext`focusPlaneZ$$, $CellContext`focusPlaneZ$6627$$, 0], 
        Hold[$CellContext`aperture$$, $CellContext`aperture$6628$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$6629$$, 0]},
       "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Plot[{
         Tooltip[
          $CellContext`circleOfConfusion[$CellContext`objectZ, \
$CellContext`focusPlaneZ$$, $CellContext`aperture$$, \
$CellContext`focalLength$$], "Circle of confusion"], 
         Tooltip[
          $CellContext`circleOfConfusionInfFocus[$CellContext`objectZ, \
$CellContext`aperture$$, $CellContext`focalLength$$], 
          "Circle of confusion for infinite focus plane"], 
         Tooltip[
          $CellContext`circleOfConfusionInfObject[$CellContext`focusPlaneZ$$, \
$CellContext`aperture$$, $CellContext`focalLength$$], 
          "Circle of confusion for an object at infinity"], 
         Null}, {$CellContext`objectZ, 0, 1000}, 
        PlotRange -> {{0, 1000}, {0, 5}}], 
      "Specifications" :> {{$CellContext`focusPlaneZ$$, 100, 
         1000}, {$CellContext`aperture$$, 2.5, 
         5}, {{$CellContext`focalLength$$, 50}, 5, 100}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{409., {187., 192.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101575158719025`*^9, 3.5101575942308397`*^9}, {
   3.510157695549818*^9, 3.510157701992629*^9}, 3.510157811224021*^9, 
   3.5101578686477222`*^9, {3.5101579077725906`*^9, 3.510157916555406*^9}, {
   3.5101579527318697`*^9, 3.5101579783159146`*^9}, 3.510158023321994*^9, 
   3.5101650342008533`*^9}]
}, Open  ]],

Cell["\<\
Thin lens function with takes lens position into consideration.\
\>", "Text",
 CellChangeTimes->{{3.510167421313388*^9, 3.5101674399884562`*^9}}],

Cell["\<\
objectPos [x,y,z,w], focalLength [f], lensPos [x,y,z]\
\>", "Text",
 CellChangeTimes->{{3.510168795850007*^9, 3.5101688327601185`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"thinLensWide", "[", 
    RowBox[{"objectPos_", ",", " ", "focalLength_", ",", " ", "lensPos_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imagePos", ",", "outputDirection"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"imagePos", "=", 
       RowBox[{"homogeneousDivide", "[", 
        RowBox[{"thinLens", "[", 
         RowBox[{"objectPos", ",", " ", "focalLength"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"outputDirection", " ", "=", 
       RowBox[{
        RowBox[{"imagePos", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "3"}], "]"}], "]"}], "+", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"imagePos", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
          RowBox[{"-", "lensPos"}], ",", "0"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"outputDirection", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"objectPos", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], " ", "<", " ", 
          "focalLength"}], ",", 
         RowBox[{"-", "outputDirection"}], ",", "outputDirection"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"lensPos", ",", " ", "outputDirection"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.510165535351517*^9, 3.510165741752323*^9}, {
  3.510166155035961*^9, 3.510166195822294*^9}, {3.5101668392070937`*^9, 
  3.510166848869646*^9}, {3.5101674975457487`*^9, 3.5101675494257154`*^9}, {
  3.510167592385173*^9, 3.5101675962993965`*^9}, {3.5101686876478186`*^9, 
  3.5101686928951187`*^9}, {3.5101687318513465`*^9, 3.5101687695645037`*^9}, {
  3.5101688365113325`*^9, 3.510168851410185*^9}}],

Cell["\<\
incomingRay [\[Theta]], focalLength [f], lensPos [x,y,z]\
\>", "Text",
 CellChangeTimes->{{3.5101688478029785`*^9, 3.5101688770196495`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"thinLensLRTF", "[", 
    RowBox[{"\[Theta]_", ",", " ", "focalLength_", ",", " ", "lensPos_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sourcePoint", ",", "outputDirection", ",", "outputLensPos"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sourcePoint", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Cos", "[", "\[Theta]", "]"}], "+", 
          RowBox[{"lensPos", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{"0", "+", 
          RowBox[{"lensPos", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Sin", "[", "\[Theta]", "]"}], "+", 
          RowBox[{"lensPos", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], ",", "1"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"outputLensPos", ",", " ", "outputDirection"}], "}"}], "=", 
       RowBox[{"thinLensWide", "[", 
        RowBox[{"sourcePoint", ",", " ", "focalLength", ",", "lensPos"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"outputDirection", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"outputDirection", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.510168854002333*^9, 3.5101689433474436`*^9}, {
  3.510168973935193*^9, 3.510169185731307*^9}, {3.510169251609075*^9, 
  3.510169260056558*^9}, {3.510171410417552*^9, 3.510171413781744*^9}, {
  3.5101715658464417`*^9, 3.5101715680025654`*^9}, {3.510171801976948*^9, 
  3.510171804393086*^9}, {3.5101725199910154`*^9, 3.5101725218901243`*^9}, {
  3.510172594786294*^9, 3.510172594950303*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"drawThinLensRay", "[", 
   RowBox[{"x_", ",", "z_", ",", "lensX_", ",", "focalLength_"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "objectPointHom", ",", " ", "imagePoint", ",", "imageDir", ",", 
      "targetPoint", ",", "lensPoint"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"objectPointHom", "=", 
      RowBox[{"{", 
       RowBox[{"x", ",", "0", ",", " ", "z", ",", "1"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lensPoint", "=", 
      RowBox[{"{", 
       RowBox[{"lensX", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"imagePoint", ",", "imageDir"}], "}"}], "=", 
      RowBox[{"Map", "[", 
       RowBox[{"getXZ", ",", 
        RowBox[{"thinLensWide", "[", 
         RowBox[{
         "objectPointHom", ",", "focalLength", ",", " ", "lensPoint"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"targetPoint", "=", 
      RowBox[{"imagePoint", " ", "+", " ", 
       RowBox[{"2", "*", 
        RowBox[{"Normalize", "[", "imageDir", "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"getXZ", "[", "objectPointHom", "]"}], ",", 
            RowBox[{"getXZ", "[", "lensPoint", "]"}]}], "}"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{"imagePoint", ",", "targetPoint"}], "}"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "lineRadius"}], ",", "focalLength"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"lineRadius", ",", "focalLength"}], "}"}]}], "}"}], 
            "]"}], ",", "\"\<Focal length\>\""}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "lineRadius"}], ",", 
                RowBox[{"-", "focalLength"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"lineRadius", ",", 
                RowBox[{"-", "focalLength"}]}], "}"}]}], "}"}], "]"}], ",", 
           "\"\<Focal length\>\""}], "]"}]}], "\[IndentingNewLine]", "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Axes", "\[Rule]", "True"}], ",", 
       RowBox[{"AxesLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<z\>\""}], "}"}]}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotRangeClipping", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"drawThinLensRay", "[", 
    RowBox[{"x", ",", "z", ",", "lensX", ",", "focalLength"}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", 
       RowBox[{"-", "4"}], ",", " ", "\"\<source point (X)\>\""}], "}"}], ",",
      " ", 
     RowBox[{"-", "10"}], ",", " ", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"z", ",", " ", "7", ",", " ", "\"\<source point (Z)\>\""}], 
      "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", " ", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lensX", ",", " ", "7", ",", " ", "\"\<lens point (X)\>\""}], 
      "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", " ", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "focalLength", ",", " ", "2", ",", " ", "\"\<focal length (Z)\>\""}], 
      "}"}], ",", " ", "0.1", ",", " ", "10"}], "}"}]}], 
  "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"drawThinLensRay", "[", 
    RowBox[{
     RowBox[{"lensX", "+", 
      RowBox[{"r", " ", 
       RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ",", 
     RowBox[{"r", " ", 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", "lensX", ",", 
     "focalLength"}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Theta]", ",", " ", "0", ",", " ", 
         "\"\<source point (\[Theta])\>\""}], "}"}], ",", " ", 
       RowBox[{
        RowBox[{"-", "\[Pi]"}], "/", "2"}], ",", 
       RowBox[{"\[Pi]", "/", "2"}]}], " ", "}"}], ","}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", " ", 
       RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
       "\"\<source point (\[Theta])\>\""}], "}"}], ",", " ", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], " ", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", " ", "5", ",", " ", "\"\<circle radius\>\""}], "}"}], 
     ",", " ", "0.1", ",", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lensX", ",", " ", "7", ",", " ", "\"\<lens point (X)\>\""}], 
      "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", " ", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "focalLength", ",", " ", "2", ",", " ", "\"\<focal length (Z)\>\""}], 
      "}"}], ",", " ", "0.1", ",", " ", "10"}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.510166247536252*^9, 3.5101663576375494`*^9}, {
   3.5101663932375855`*^9, 3.5101664197461014`*^9}, {3.5101664693149366`*^9, 
   3.5101665277982817`*^9}, {3.510166574541956*^9, 3.510166591462923*^9}, {
   3.510166664751115*^9, 3.510166665791175*^9}, {3.5101667653878713`*^9, 
   3.5101667706741734`*^9}, {3.5101669152934456`*^9, 3.510166915522458*^9}, {
   3.510166982215273*^9, 3.5101671619135513`*^9}, {3.510167202590878*^9, 
   3.510167208260202*^9}, 3.5101672450433064`*^9, {3.5101676833583765`*^9, 
   3.5101679722108974`*^9}, {3.510168004579749*^9, 3.5101680063748517`*^9}, {
   3.510171186023717*^9, 3.5101711947882185`*^9}, {3.510171224813936*^9, 
   3.5101712286521554`*^9}, {3.510171618977481*^9, 3.510171619196493*^9}, {
   3.5101719776889977`*^9, 3.5101719921578255`*^9}, {3.5102113996989765`*^9, 
   3.5102114283766165`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
    0.45000000000000107`, $CellContext`x$$ = -2.8, $CellContext`z$$ = -2., 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`x$$], -4, "source point (X)"}, -10, 10}, {{
       Hold[$CellContext`z$$], 7, "source point (Z)"}, -10, 10}, {{
       Hold[$CellContext`lensX$$], 7, "lens point (X)"}, -10, 10}, {{
       Hold[$CellContext`focalLength$$], 2, "focal length (Z)"}, 0.1, 10}}, 
    Typeset`size$$ = {360., {178., 182.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`x$945712$$ = 0, $CellContext`z$945713$$ = 
    0, $CellContext`lensX$945714$$ = 0, $CellContext`focalLength$945715$$ = 
    0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
        7, $CellContext`x$$ = -4, $CellContext`z$$ = 7}, 
      "ControllerVariables" :> {
        Hold[$CellContext`x$$, $CellContext`x$945712$$, 0], 
        Hold[$CellContext`z$$, $CellContext`z$945713$$, 0], 
        Hold[$CellContext`lensX$$, $CellContext`lensX$945714$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$945715$$, 
         0]}, "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> $CellContext`drawThinLensRay[$CellContext`x$$, \
$CellContext`z$$, $CellContext`lensX$$, $CellContext`focalLength$$], 
      "Specifications" :> {{{$CellContext`x$$, -4, "source point (X)"}, -10, 
         10}, {{$CellContext`z$$, 7, "source point (Z)"}, -10, 
         10}, {{$CellContext`lensX$$, 7, "lens point (X)"}, -10, 
         10}, {{$CellContext`focalLength$$, 2, "focal length (Z)"}, 0.1, 10}},
       "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {265., 270.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101662990802*^9, 3.5101663091087737`*^9}, 
   3.510166367278101*^9, 3.5101665295193806`*^9, 3.5101665829294353`*^9, 
   3.5101667718412404`*^9, 3.5101669157534714`*^9, {3.5101669864195137`*^9, 
   3.510166994287964*^9}, {3.510167107301428*^9, 3.5101671622655716`*^9}, 
   3.510167210895353*^9, 3.510167245846352*^9, {3.5101677619658723`*^9, 
   3.5101677784628158`*^9}, 3.5101678890261393`*^9, {3.51016793938002*^9, 
   3.5101679725909195`*^9}, 3.5101680115161457`*^9, 3.510171195285247*^9, 
   3.5101712289761744`*^9, 3.5101714420733624`*^9, 3.5101715859995947`*^9, 
   3.5101716195985165`*^9, {3.510171972671711*^9, 3.5101719927448587`*^9}, 
   3.510211358995648*^9, {3.510211405501308*^9, 3.510211429099658*^9}, 
   3.5102163698159285`*^9}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
    7, $CellContext`r$$ = 5, $CellContext`\[Theta]$$ = 1.156106096521044, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`\[Theta]$$], Rational[1, 2] Pi, 
       "source point (\[Theta])"}, 0, 2 Pi}, {{
       Hold[$CellContext`r$$], 5, "circle radius"}, 0.1, 10}, {{
       Hold[$CellContext`lensX$$], 7, "lens point (X)"}, -10, 10}, {{
       Hold[$CellContext`focalLength$$], 2, "focal length (Z)"}, 0.1, 10}}, 
    Typeset`size$$ = {360., {178., 182.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`\[Theta]$945750$$ = 0, $CellContext`r$945751$$ = 
    0, $CellContext`lensX$945752$$ = 0, $CellContext`focalLength$945753$$ = 
    0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
        7, $CellContext`r$$ = 5, $CellContext`\[Theta]$$ = Rational[1, 2] Pi},
       "ControllerVariables" :> {
        Hold[$CellContext`\[Theta]$$, $CellContext`\[Theta]$945750$$, 0], 
        Hold[$CellContext`r$$, $CellContext`r$945751$$, 0], 
        Hold[$CellContext`lensX$$, $CellContext`lensX$945752$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$945753$$, 
         0]}, "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> $CellContext`drawThinLensRay[$CellContext`lensX$$ + \
$CellContext`r$$ Cos[$CellContext`\[Theta]$$], $CellContext`r$$ 
        Sin[$CellContext`\[Theta]$$], $CellContext`lensX$$, \
$CellContext`focalLength$$], 
      "Specifications" :> {{{$CellContext`\[Theta]$$, Rational[1, 2] Pi, 
          "source point (\[Theta])"}, 0, 2 
         Pi}, {{$CellContext`r$$, 5, "circle radius"}, 0.1, 
         10}, {{$CellContext`lensX$$, 7, "lens point (X)"}, -10, 
         10}, {{$CellContext`focalLength$$, 2, "focal length (Z)"}, 0.1, 10}},
       "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {265., 270.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101662990802*^9, 3.5101663091087737`*^9}, 
   3.510166367278101*^9, 3.5101665295193806`*^9, 3.5101665829294353`*^9, 
   3.5101667718412404`*^9, 3.5101669157534714`*^9, {3.5101669864195137`*^9, 
   3.510166994287964*^9}, {3.510167107301428*^9, 3.5101671622655716`*^9}, 
   3.510167210895353*^9, 3.510167245846352*^9, {3.5101677619658723`*^9, 
   3.5101677784628158`*^9}, 3.5101678890261393`*^9, {3.51016793938002*^9, 
   3.5101679725909195`*^9}, 3.5101680115161457`*^9, 3.510171195285247*^9, 
   3.5101712289761744`*^9, 3.5101714420733624`*^9, 3.5101715859995947`*^9, 
   3.5101716195985165`*^9, {3.510171972671711*^9, 3.5101719927448587`*^9}, 
   3.510211358995648*^9, {3.510211405501308*^9, 3.510211429099658*^9}, 
   3.5102163699299355`*^9}]
}, Open  ]],

Cell["\<\
Observations:
- the distance of the object point (ie. origin of the incoming ray) doesn\
\[CloseCurlyQuote]t affect the outgoing ray!
- for thin lens the incoming and outgoing lens position is the same
- at lens point farther away when the incoming ray angle changes there is a \
range of slow change in outgoing ray angle followed by a range of faster motion
- focal length affects the steepness of the ray angle dependence\
\>", "Text",
 CellChangeTimes->{{3.5101681810538425`*^9, 3.5101682404482403`*^9}, {
  3.5101683223819265`*^9, 3.510168339248891*^9}, {3.510168555278247*^9, 
  3.510168665895574*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"thinLensLRTF", "[", 
   RowBox[{".5", ",", "5", ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], "//", "N"}]], "Input",
 CellChangeTimes->{{3.510169202858287*^9, 3.5101692203712883`*^9}, {
  3.510169299981842*^9, 3.5101693183858943`*^9}, {3.51017002323621*^9, 
  3.5101700420102835`*^9}, {3.5101716303601317`*^9, 3.5101716342693553`*^9}}],

Cell[BoxData[
 RowBox[{"-", "2.0284199285136792`"}]], "Output",
 CellChangeTimes->{
  3.5101692209143195`*^9, 3.5101692660439005`*^9, {3.5101693059081807`*^9, 
   3.510169318695912*^9}, {3.510170024145262*^9, 3.5101700423623037`*^9}, {
   3.510171626624918*^9, 3.51017163452237*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"drawThinLensRayAngle", "[", 
   RowBox[{"x_", ",", "z_", ",", "lensX_", ",", "focalLength_"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "objectPoint", ",", " ", "imageDir", ",", "targetPoint", ",", 
      "lensPoint", ",", "input\[Theta]", ",", "output\[Theta]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"objectPoint", "=", 
      RowBox[{
       RowBox[{"4", "*", 
        RowBox[{"Normalize", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "-", "lensX"}], ",", "z"}], "}"}], "]"}]}], "+", 
       RowBox[{"{", 
        RowBox[{"lensX", ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lensPoint", "=", 
      RowBox[{"{", 
       RowBox[{"lensX", ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"input\[Theta]", "=", 
      RowBox[{"ArcTan", "[", 
       RowBox[{
        RowBox[{"x", "-", "lensX"}], ",", "z"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"output\[Theta]", "=", 
      RowBox[{"thinLensLRTF", "[", 
       RowBox[{"input\[Theta]", ",", "focalLength", ",", " ", "lensPoint"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"imageDir", " ", "=", " ", 
      RowBox[{"4", "*", 
       RowBox[{"Normalize", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cos", "[", "output\[Theta]", "]"}], ",", 
          RowBox[{"Sin", "[", "output\[Theta]", "]"}]}], "}"}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"targetPoint", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lensX", ",", "0"}], "}"}], "+", "imageDir"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{"objectPoint", ",", 
            RowBox[{"getXZ", "[", "lensPoint", "]"}]}], "}"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Arrow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"lensX", ",", "0"}], "}"}], ",", "targetPoint"}], "}"}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "lineRadius"}], ",", "focalLength"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"lineRadius", ",", "focalLength"}], "}"}]}], "}"}], 
            "]"}], ",", "\"\<Focal length\>\""}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "lineRadius"}], ",", 
                RowBox[{"-", "focalLength"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"lineRadius", ",", 
                RowBox[{"-", "focalLength"}]}], "}"}]}], "}"}], "]"}], ",", 
           "\"\<Focal length\>\""}], "]"}]}], "\[IndentingNewLine]", "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Axes", "\[Rule]", "True"}], ",", 
       RowBox[{"AxesLabel", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<z\>\""}], "}"}]}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotRangeClipping", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"drawThinLensRayAngle", "[", 
    RowBox[{
     RowBox[{"lensX", "+", 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
     RowBox[{"Cos", "[", "\[Theta]", "]"}], ",", "lensX", ",", 
     "focalLength"}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Theta]", ",", " ", "0", ",", " ", 
       "\"\<source point (\[Theta])\>\""}], "}"}], ",", " ", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], " ", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lensX", ",", " ", "5", ",", " ", "\"\<lens point (X)\>\""}], 
      "}"}], ",", " ", 
     RowBox[{"-", "10"}], ",", " ", "10"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "focalLength", ",", " ", "2", ",", " ", "\"\<focal length (Z)\>\""}], 
      "}"}], ",", " ", "0.1", ",", " ", "10"}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.510169390792036*^9, 3.510169496734095*^9}, {
  3.5101695633859076`*^9, 3.510169609551548*^9}, {3.510169646058636*^9, 
  3.5101696707990513`*^9}, {3.510169743026182*^9, 3.510169871713543*^9}, {
  3.5101699111687994`*^9, 3.510169975038453*^9}, {3.51017011537948*^9, 
  3.510170116795561*^9}, {3.5101701655393486`*^9, 3.5101702276669025`*^9}, {
  3.5101702581816473`*^9, 3.5101703156569347`*^9}, {3.510170360757515*^9, 
  3.510170392461328*^9}, {3.5101708322844844`*^9, 3.5101708673054876`*^9}, {
  3.5101709028835225`*^9, 3.5101709297080564`*^9}, {3.5101710030772533`*^9, 
  3.5101710097226334`*^9}, {3.5101710545331964`*^9, 3.5101710870650573`*^9}, {
  3.5101714616894846`*^9, 3.5101714850608215`*^9}, {3.510171533359584*^9, 
  3.510171533662601*^9}, {3.5101716623649626`*^9, 3.510171737001231*^9}, {
  3.510171812191532*^9, 3.510171816226763*^9}, {3.5101719613770647`*^9, 
  3.5101719619230957`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
    5.472311019897461, $CellContext`\[Theta]$$ = 0., Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`\[Theta]$$], 0, "source point (\[Theta])"}, 0, 2 
      Pi}, {{
       Hold[$CellContext`lensX$$], 5, "lens point (X)"}, -10, 10}, {{
       Hold[$CellContext`focalLength$$], 2, "focal length (Z)"}, 0.1, 10}}, 
    Typeset`size$$ = {360., {178., 182.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`\[Theta]$7076$$ = 0, $CellContext`lensX$7077$$ = 
    0, $CellContext`focalLength$7078$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`focalLength$$ = 2, $CellContext`lensX$$ = 
        5, $CellContext`\[Theta]$$ = 0}, "ControllerVariables" :> {
        Hold[$CellContext`\[Theta]$$, $CellContext`\[Theta]$7076$$, 0], 
        Hold[$CellContext`lensX$$, $CellContext`lensX$7077$$, 0], 
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$7078$$, 0]},
       "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, 
      "Body" :> $CellContext`drawThinLensRayAngle[$CellContext`lensX$$ + 
        Sin[$CellContext`\[Theta]$$], 
        Cos[$CellContext`\[Theta]$$], $CellContext`lensX$$, \
$CellContext`focalLength$$], 
      "Specifications" :> {{{$CellContext`\[Theta]$$, 0, 
          "source point (\[Theta])"}, 0, 2 
         Pi}, {{$CellContext`lensX$$, 5, "lens point (X)"}, -10, 
         10}, {{$CellContext`focalLength$$, 2, "focal length (Z)"}, 0.1, 10}},
       "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {251., 256.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101703772454576`*^9, 3.510170393967414*^9}, {
   3.5101706444567413`*^9, 3.510170654062291*^9}, {3.5101708370907593`*^9, 
   3.510170867617505*^9}, {3.510170912722085*^9, 3.510170930535104*^9}, 
   3.5101710101316566`*^9, {3.5101710661458607`*^9, 3.51017108816512*^9}, {
   3.5101714669697866`*^9, 3.5101714854868455`*^9}, 3.510171537364813*^9, 
   3.5101715725748267`*^9, 3.510171666276186*^9, {3.510171697880994*^9, 
   3.5101717378662806`*^9}, 3.5101718167217913`*^9, {3.5101719572618294`*^9, 
   3.5101719622721157`*^9}, 3.5101725290125313`*^9, 3.510172599952589*^9, {
   3.5102114102045774`*^9, 3.5102114324458494`*^9}}]
}, Open  ]],

Cell["\<\
Lens Ray Transfer Function of a thin-lens model.
\
\>", "Text",
 CellChangeTimes->{{3.5101723164923763`*^9, 3.5101723337313623`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Plot", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"thinLensLRTF", "[", 
        RowBox[{"\[Theta]", ",", "focalLength", ",", " ", 
         RowBox[{"{", 
          RowBox[{"lensX", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Theta]", "-", "\[Pi]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"thinLensLRTF", "[", 
         RowBox[{"\[Theta]", ",", "focalLength", ",", " ", 
          RowBox[{"{", 
           RowBox[{"lensX", ",", "0", ",", "0"}], "}"}]}], "]"}], "-", 
        RowBox[{"(", 
         RowBox[{"\[Theta]", "-", "\[Pi]"}], ")"}]}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", "0", ",", 
       RowBox[{"2", " ", "\[Pi]"}]}], "}"}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", "10", ",", "\"\<focal length\>\""}], "}"}], 
     ",", "0.1", ",", "50"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lensX", ",", "5", ",", "\"\<lens point (X)\>\""}], "}"}], ",", 
     RowBox[{"-", "100"}], ",", "100"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.510172037139398*^9, 3.5101722585410614`*^9}, {
  3.5101723492062473`*^9, 3.5101723893915462`*^9}, {3.5101724347911425`*^9, 
  3.510172470953211*^9}, {3.51017250363708*^9, 3.510172507167282*^9}, {
  3.5102155789876957`*^9, 3.5102157687845516`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`focalLength$$ = 6.4, $CellContext`lensX$$ = 
    2.5, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`focalLength$$], 10, "focal length"}, 0.1, 50}, {{
       Hold[$CellContext`lensX$$], 5, "lens point (X)"}, -100, 100}}, 
    Typeset`size$$ = {360., {107., 111.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`focalLength$391174$$ = 0, $CellContext`lensX$391175$$ =
     0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`focalLength$$ = 10, $CellContext`lensX$$ = 
        5}, "ControllerVariables" :> {
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$391174$$, 
         0], 
        Hold[$CellContext`lensX$$, $CellContext`lensX$391175$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Plot[{
         $CellContext`thinLensLRTF[$CellContext`\[Theta], \
$CellContext`focalLength$$, {$CellContext`lensX$$, 0, 
           0}], $CellContext`\[Theta] - 
         Pi, $CellContext`thinLensLRTF[$CellContext`\[Theta], \
$CellContext`focalLength$$, {$CellContext`lensX$$, 0, 
            0}] - ($CellContext`\[Theta] - Pi)}, {$CellContext`\[Theta], 0, 2 
         Pi}], "Specifications" :> {{{$CellContext`focalLength$$, 10, 
          "focal length"}, 0.1, 
         50}, {{$CellContext`lensX$$, 5, "lens point (X)"}, -100, 100}}, 
      "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {167., 172.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5101721994696827`*^9, 3.5101722100442877`*^9}, 
   3.5101722589160833`*^9, {3.5101723547905664`*^9, 3.510172389863573*^9}, {
   3.510172448104904*^9, 3.5101724711892242`*^9}, 3.5101725485016465`*^9, 
   3.510172609620142*^9, 3.510215615097761*^9, {3.510215656560133*^9, 
   3.5102156982685184`*^9}, {3.510215750095483*^9, 3.5102157709156733`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DensityPlot", "[", 
    RowBox[{
     RowBox[{"thinLensLRTF", "[", 
      RowBox[{"\[Theta]", ",", "focalLength", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"aperture", "*", "lensX"}], ",", "0", ",", "0"}], "}"}]}], 
      "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", "0", ",", 
       RowBox[{"2", " ", "\[Pi]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"lensX", ",", 
       RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}]}], 
    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"focalLength", ",", "10", ",", "\"\<focal length\>\""}], "}"}], 
     ",", "0.1", ",", "50"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aperture", ",", "10", ",", "\"\<aperture radius\>\""}], "}"}], 
     ",", "0.1", ",", "100"}], "}"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.510173043390971*^9, 3.510173130992982*^9}, {
  3.510173190295374*^9, 3.51017319092941*^9}, {3.5101732354029536`*^9, 
  3.510173257491217*^9}, {3.5101733019417596`*^9, 3.510173305891986*^9}, {
  3.510173355377816*^9, 3.510173388881732*^9}, {3.5101734617539005`*^9, 
  3.510173492766674*^9}, {3.51017353937634*^9, 3.5101735484388585`*^9}, {
  3.510173893920619*^9, 3.510173964665665*^9}, {3.5101740074001093`*^9, 
  3.5101740371758127`*^9}, {3.5101740861356125`*^9, 3.510174093523035*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`aperture$$ = 
    10, $CellContext`focalLength$$ = 10, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`focalLength$$], 10, "focal length"}, 0.1, 50}, {{
       Hold[$CellContext`aperture$$], 10, "aperture radius"}, 0.1, 100}}, 
    Typeset`size$$ = {360., {174., 178.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`focalLength$1847455$$ = 
    0, $CellContext`aperture$1847456$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`aperture$$ = 
        10, $CellContext`focalLength$$ = 10}, "ControllerVariables" :> {
        Hold[$CellContext`focalLength$$, $CellContext`focalLength$1847455$$, 
         0], 
        Hold[$CellContext`aperture$$, $CellContext`aperture$1847456$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> DensityPlot[
        $CellContext`thinLensLRTF[$CellContext`\[Theta], \
$CellContext`focalLength$$, {$CellContext`aperture$$ $CellContext`lensX, 0, 
          0}], {$CellContext`\[Theta], 0, 2 Pi}, {$CellContext`lensX, -1, 1}, 
        ColorFunction -> "TemperatureMap"], 
      "Specifications" :> {{{$CellContext`focalLength$$, 10, "focal length"}, 
         0.1, 50}, {{$CellContext`aperture$$, 10, "aperture radius"}, 0.1, 
         100}}, "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{409., {234., 239.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.510173063638129*^9, 3.5101730978580866`*^9}, 
   3.5101731314070053`*^9, 3.51017319128243*^9, {3.510173302912815*^9, 
   3.510173306213004*^9}, 3.5101733570289106`*^9, 3.510173389282755*^9, {
   3.5101734653361053`*^9, 3.510173493100693*^9}, 3.510173548737876*^9, 
   3.510173921720209*^9, 3.510173967633835*^9, {3.510174015576577*^9, 
   3.5101740375218325`*^9}, {3.51017409220796*^9, 3.510174093986062*^9}}]
}, Open  ]],

Cell["\<\
Observations:
- for sufficiently large focal length and sufficiently small aperture the \
LRTF is similar to a linear function
- as the focal length approaches zero (the lens gets more \
\[OpenCurlyDoubleQuote]wide-angle\[CloseCurlyDoubleQuote]) the LRTF \
approaches a step function
- as the aperture increases the LRTF approaches a step function but less \
steeply\
\>", "Text",
 CellChangeTimes->{{3.510173623532153*^9, 3.5101737391027637`*^9}, {
  3.5101741560966144`*^9, 3.5101741840072107`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "direction", ",", "objectPos", ",", "lensPos", ",", " ", "focalLength"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"focalLength", "=", "5"}], ";", "\[IndentingNewLine]", 
    RowBox[{"direction", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "15"}], "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"lensPos", "=", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"objectPos", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"lensPos", " ", "-", " ", "direction"}], ")"}], "~", "Join", 
      "~", 
      RowBox[{"{", "1", "}"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Column", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"thinLensWide", "[", 
         RowBox[{"objectPos", ",", " ", "focalLength", ",", "lensPos"}], " ", 
         "]"}], "//", "N"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"homogeneousDivide", "[", " ", 
         RowBox[{
          RowBox[{"thinLensTransform", "[", 
           RowBox[{"addFocalLengthSign", "[", 
            RowBox[{"focalLength", ",", 
             RowBox[{"objectPos", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], ".", 
          "objectPos"}], "]"}], "//", "N"}]}], "}"}], "]"}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.5102112406758804`*^9, 3.510211242030958*^9}, {
   3.510211440380303*^9, 3.5102114786024895`*^9}, {3.510211606175786*^9, 
   3.510211606655813*^9}, 3.5102130031196866`*^9, {3.51021303605657*^9, 
   3.5102130372566395`*^9}, {3.5102132429544044`*^9, 
   3.5102133145895014`*^9}, {3.510213384938525*^9, 3.5102133852345424`*^9}, {
   3.510213766526351*^9, 3.5102137674254026`*^9}, {3.510216671885206*^9, 
   3.510216691570332*^9}, 3.51021814983774*^9, {3.5102182296503053`*^9, 
   3.51021831610225*^9}, {3.5102183802799206`*^9, 3.5102183915215635`*^9}, {
   3.5102184246634593`*^9, 3.5102185739940004`*^9}, {3.510218644394027*^9, 
   3.5102186798070526`*^9}, {3.5102187366053014`*^9, 
   3.5102187369683223`*^9}, {3.510219360243972*^9, 3.510219367644395*^9}, {
   3.510219493897616*^9, 3.5102194975468245`*^9}, 3.5102195472006645`*^9, {
   3.5102195838657618`*^9, 3.510219640702013*^9}, 3.5102197022545333`*^9, {
   3.51021995377792*^9, 3.5102199554850173`*^9}, {3.5102202014690866`*^9, 
   3.5102202024281416`*^9}, {3.510220325276168*^9, 3.510220327456293*^9}, {
   3.510220390956925*^9, 3.5102204068048315`*^9}, {3.5102204435589333`*^9, 
   3.5102204555866213`*^9}, 3.510220492782749*^9}],

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2.`", ",", "3.`", ",", "0.`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "2.5`"}], ",", 
         RowBox[{"-", "3.5`"}], ",", "7.5`"}], "}"}]}], "}"}]},
    {
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.5`"}], ",", 
       RowBox[{"-", "0.5`"}], ",", "7.5`", ",", "1.`"}], "}"}]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Output",
 CellChangeTimes->{
  3.5102114789375086`*^9, 3.510211607087838*^9, 3.5102130042797527`*^9, 
   3.5102130376146593`*^9, {3.51021324445249*^9, 3.5102133149555225`*^9}, 
   3.510213385505558*^9, 3.5102137677404203`*^9, {3.51021667246824*^9, 
   3.510216692044359*^9}, 3.5102181513438263`*^9, 3.5102183923376102`*^9, {
   3.5102184363121257`*^9, 3.5102184527180643`*^9}, {3.5102184906632347`*^9, 
   3.510218574353021*^9}, {3.510218644930058*^9, 3.5102186803600845`*^9}, 
   3.5102187372783403`*^9, {3.5102193605909915`*^9, 3.5102193680584183`*^9}, 
   3.510219498664889*^9, {3.5102195477686973`*^9, 3.510219641085035*^9}, 
   3.5102197025245485`*^9, 3.5102197448629704`*^9, 3.5102199560320487`*^9, 
   3.510220202644154*^9, 3.510220330419462*^9, 3.510220360991211*^9, {
   3.510220391233941*^9, 3.5102204070668464`*^9}, {3.5102204463400927`*^9, 
   3.5102204560406475`*^9}, 3.510220493299779*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"thinLensWide", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "5", ",", "1"}], "}"}], ",", "5", ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "0"}], "}"}]}], " ", "]"}], "//", 
  "N"}]], "Input",
 CellChangeTimes->{{3.5102210516377134`*^9, 3.510221084006565*^9}, {
   3.5102211635971174`*^9, 3.5102211648741903`*^9}, {3.510221227471771*^9, 
   3.5102212559333987`*^9}, {3.510221290975403*^9, 3.5102213131696725`*^9}, {
   3.510221980838861*^9, 3.5102219998539486`*^9}, 3.510222197164234*^9, {
   3.510222260537859*^9, 3.510222262149951*^9}, {3.5102238535449734`*^9, 
   3.5102238656636667`*^9}, {3.51022411957819*^9, 3.510224133881008*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.`", ",", "3.`", ",", "0.`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1.`", ",", "2.`", ",", "5.`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.5102210739889917`*^9, 3.5102210850476246`*^9}, 
   3.510221165206209*^9, {3.510221229685898*^9, 3.510221256393425*^9}, {
   3.5102212912934213`*^9, 3.5102213134846907`*^9}, {3.5102219810978756`*^9, 
   3.510222000196968*^9}, 3.5102221974672513`*^9, {3.510222260815875*^9, 
   3.5102222623879642`*^9}, {3.510223854150008*^9, 3.510223865949683*^9}, {
   3.5102241165620174`*^9, 3.5102241367621727`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"thinLensTransform", "[", "5", "]"}], ".", 
  RowBox[{"{", 
   RowBox[{"1", ",", "2", ",", "5", ",", "1"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.5102222747796736`*^9, 3.510222284128208*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "2", ",", "5", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{3.5102222845472317`*^9}]
}, Open  ]]
},
WindowSize->{707, 787},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (November 13, 2010)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 150, 3, 31, "Input"],
Cell[CellGroupData[{
Cell[732, 27, 1053, 24, 52, "Input"],
Cell[1788, 53, 850, 23, 96, "Output"]
}, Open  ]],
Cell[2653, 79, 270, 8, 29, "Text"],
Cell[CellGroupData[{
Cell[2948, 91, 2284, 56, 72, "Input"],
Cell[5235, 149, 1605, 45, 82, "Output"]
}, Open  ]],
Cell[6855, 197, 2550, 60, 189, "Text"],
Cell[9408, 259, 5358, 126, 392, "Input"],
Cell[CellGroupData[{
Cell[14791, 389, 8024, 171, 552, "Input"],
Cell[22818, 562, 3435, 63, 602, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26290, 630, 2001, 54, 92, "Input"],
Cell[28294, 686, 3529, 65, 628, "Output"]
}, Open  ]],
Cell[31838, 754, 220, 4, 47, "Text"],
Cell[CellGroupData[{
Cell[32083, 762, 5212, 114, 372, "Input"],
Cell[37298, 878, 3968, 73, 524, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[41303, 956, 356, 8, 31, "Input"],
Cell[41662, 966, 357, 9, 47, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42056, 980, 712, 14, 31, "Input"],
Cell[42771, 996, 480, 9, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43288, 1010, 916, 25, 92, "Input"],
Cell[44207, 1037, 1577, 45, 82, "Output"],
Cell[45787, 1084, 433, 11, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[46257, 1100, 901, 23, 92, "Input"],
Cell[47161, 1125, 1717, 50, 113, "Output"],
Cell[48881, 1177, 460, 12, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49378, 1194, 949, 25, 112, "Input"],
Cell[50330, 1221, 1671, 48, 113, "Output"],
Cell[52004, 1271, 439, 11, 30, "Output"]
}, Open  ]],
Cell[52458, 1285, 121, 3, 29, "Text"],
Cell[52582, 1290, 1558, 38, 152, "Input"],
Cell[CellGroupData[{
Cell[54165, 1332, 1926, 49, 232, "Input"],
Cell[56094, 1383, 3115, 59, 396, "Output"]
}, Open  ]],
Cell[59224, 1445, 155, 3, 29, "Text"],
Cell[59382, 1450, 145, 3, 29, "Text"],
Cell[59530, 1455, 1973, 47, 172, "Input"],
Cell[61506, 1504, 150, 3, 29, "Text"],
Cell[61659, 1509, 1920, 45, 152, "Input"],
Cell[CellGroupData[{
Cell[63604, 1558, 7301, 182, 712, "Input"],
Cell[70908, 1742, 3324, 58, 552, "Output"],
Cell[74235, 1802, 3529, 62, 552, "Output"]
}, Open  ]],
Cell[77779, 1867, 618, 11, 119, "Text"],
Cell[CellGroupData[{
Cell[78422, 1882, 404, 8, 31, "Input"],
Cell[78829, 1892, 283, 5, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[79149, 1902, 6082, 148, 552, "Input"],
Cell[85234, 2052, 3054, 55, 524, "Output"]
}, Open  ]],
Cell[88303, 2110, 143, 4, 47, "Text"],
Cell[CellGroupData[{
Cell[88471, 2118, 1577, 37, 152, "Input"],
Cell[90051, 2157, 2616, 49, 356, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[92704, 2211, 1652, 35, 172, "Input"],
Cell[94359, 2248, 2604, 48, 490, "Output"]
}, Open  ]],
Cell[96978, 2299, 511, 11, 83, "Text"],
Cell[CellGroupData[{
Cell[97514, 2314, 2665, 54, 212, "Input"],
Cell[100182, 2370, 1481, 32, 42, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[101700, 2407, 708, 14, 31, "Input"],
Cell[102411, 2423, 627, 12, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[103075, 2440, 228, 5, 31, "Input"],
Cell[103306, 2447, 137, 3, 30, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
